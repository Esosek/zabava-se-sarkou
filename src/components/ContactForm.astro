<form class="submit-form" method="POST">
  <div>
    <label for="name">Jméno a příjmení</label>
    <input name="name" type="text" required />
  </div>

  <div>
    <label for="email">Email</label>
    <input name="email" type="email" required />
  </div>

  <div>
    <label for="message">Zpráva</label>
    <textarea name="message" required></textarea>
  </div>

  <div>
    <input name="subscribe" type="checkbox" />
    <label for="subscribe"
      >Chci dostávat e-mailem novinky a upozornění na nové programy.</label
    >
  </div>

  <div class="phone-input">
    <input name="user-number" type="text" value="" tabindex="-1" />
  </div>

  <button type="submit">Odeslat</button>
</form>

<script is:inline>
  const formElement = document.querySelector('.submit-form');
  formElement.addEventListener('submit', (e) => {
    e.preventDefault();

    const formData = new FormData(e.currentTarget);
    if (!isInputValid(formData)) {
      return;
    }
    submitForm(formData);
  });

  function isInputValid(input) {
    let isValid = true;

    if (input.get('user-number') !== '') {
      // Handle bots
      isValid = false;
    }
    return isValid;
  }

  async function submitForm(formData) {
    const url = '/api/contact';
    const response = await fetch(url, {
      method: 'POST',
      body: formData,
    });
    if (response.ok) {
      fireSubmitEvent();
    } else {
      const errorData = await response.json();
      console.error(response.status, errorData.error);
    }
  }

  function fireSubmitEvent() {
    gtag('event', 'form_submit');
  }
</script>

<style>
  .phone-input {
    position: absolute;
    left: -5000px;
  }
</style>
